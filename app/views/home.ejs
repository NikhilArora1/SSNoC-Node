<!DOCTYPE html>
<html>
	<head>
		<title>SSNoC SB4</title>
		<script type="text/javascript" src="/js/socket.io.min.js"></script>
		<script type="text/javascript" src="/js/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="/js/jquery.loadTemplate-1.4.4.min.js"></script>
		<script type="text/javascript" src="/js/date.js"></script>
		<link rel="stylesheet" href="/css/toastr.min.css"/>
		<script type="text/javascript" src="/js/toastr.min.js"></script>
		<script type="text/javascript" src="/js/ssnoc-api.js"></script>
		<script type="text/javascript" src="/js/socket-api.js"></script>
		<script>
			$.ajax({
	      		url:  '/user',
	      		type: 'GET',
	      		dataType: 'json'
	    	}).done(function(data) {
	    		console.log(JSON.stringify(data)); //for test
	      		statusCode= data.local.status.status;
	      		console.log(JSON.stringify(statusCode));
	      		selObj=document.getElementById("selectStatus");
		    	statuses=["GREEN","YELLOW","RED"];	
		    	displayStatuses=["OK","Help","Emergency"];
		    	htmlStr="";
		    	for(i=0;i<statuses.length;i++){
		    		if(statusCode===statuses[i]){htmlStr+="<option value='"+statuses[i]+"' selected='selected'>"+displayStatuses[i]+"</option>"; }
		    		else {htmlStr+="<option value='"+statuses[i]+"'>"+displayStatuses[i]+"</option>"}
		    	}
		    	selObj.innerHTML=htmlStr;
	      	});	
		</script>
		<link rel="stylesheet" href="/css/ssnoc.css"/>
		<script type="text/javascript">
			function showPublicWall(){
				$("#peopleDirectory").hide();
				$("#chatBuddies").hide();
				refreshPublicWall();
				$("#publicWall").show();
			}

			function showPeopleDirectory(){
				$("#publicWall").hide();
				$("#chatBuddies").hide();
				refreshPeopleDirectory();
				$("#peopleDirectory").show();
			}

			function showPrivateChat(){
				$("#publicWall").hide();
				$("#peopleDirectory").hide();
				refreshChatBuddies();
				$("#chatBuddies").show();
			}

			function selectPage(selObj){
				content=selObj.options[selObj.selectedIndex].value;
				if(content==="publicWall"){
					showPublicWall();
				} else if(content==="peopleDirectory"){
					showPeopleDirectory();
				} else if(content==="privateChat"){
					showPrivateChat();
				}
			}

			$(document).ready(function(){
				// show public wall on document load
				showPublicWall();
				$("#pageSelector").val("publicWall");
			});
		</script>
	</head>

	<body>
		<div id="header" class="longBar">
			<table class="head">
                        <tr><td><h3 class="head" id="username"></h3></td><td></td><td class="a"><form action="/logout"><input type="submit" value="logout"></form></td></tr>
                        <tr>
                        	<td>
                        		<select id="selectStatus">	
                        			<!--
                        			<option value="GREEN" >OK</option>
                        			<option value="YELLOW" >Help</option>
                        			<option value="RED" >Emergency</option>
                        			-->
                        		</select>
                        	</td>
                        </tr>
            </table>
		</div>
		<div class="longBar">
			<form>
        		<select id="pageSelector" onchange="selectPage(this);">
        			<option value="publicWall">Public Wall</option>
        			<option value="peopleDirectory">People Directory</option>
        			<option value="privateChat">Private Chat</option>
        		</select>
        	</form>
		</div>
		<div id="content">
			<div id="publicWall">
				<div id="submitMessageBar" class="longBar">
					<input id="wallMessage" type="text" name="message"/>
					<button id="submitWallMessage">Submit Wall Message</button>
				</div>
				<div id="messages">
				</div>
			</div>
			<div id="peopleDirectory">
				<h2>Online Users</h2>
				<div id="onlineUsers">
				</div>
				<h2>Offline Users</h2>
				<div id="offlineUsers">
				</div>
			</div>
			<div id="chatBuddies">
			</div>
		</div>
		<script type="text/html" id="people_directory_template">
            <div class="shortBar">
            	<img class="userProfileImage" data-src="userProfileImage"/>
                <h5 class="username" data-content="username"></h5>
                <img class="userOnlineIcon" data-src="userOnlineIcon"/>
                <p class="userStatus">Status:
                	<span class="statusCode" data-content="status" data-format="StatusFormatter"></span>
                    <img data-src="statusIcon"/>
                </p>
                <p class="userStatusUpdateTime">Updated: 
                <span class="timestamp" data-content="updatedAt"></span>
                </p>
                <button type="button" id="launchPrivateChat">Private Chat</button>
            </div>
        </script>
        <script type="text/html" id="wall_message_template">
            <div  class="shortBar">
                <h5 class="username" data-content="author"></h5>
                <span class="timestamp" data-content="postedAt"></span>
                <p class="messageText" data-content="content" >
                </p>
			</div>
        </script>
		<script type="text/html" id="wall_status_template">
            <div  class="shortBar">
                <h5 class="username" data-content="username"></h5>
                <span class="timestamp" data-content="updatedAt"></span>
                <p class="status">
                    Status:
                    <span class="statusCode" data-content="status" data-format="StatusFormatter"></span>
                    <img data-src="statusIcon"/>
                </p>
            </div>
        </script>
        <script type="text/html" id="chat_buddy_user">
        	<div class="chatBuddy">
        		<h5 class="username" data-content="username"></h5>
    			<img class="userOnlineIcon" data-src="userOnlineIcon"/>
        	</div>
        </script>
	</body>
</html>